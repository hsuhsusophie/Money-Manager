import{d as b,u as R,c as r,a,t as u,b as w,F as f,r as D,n as V,e as E,o as l,_ as T}from"./index-br766j4-.js";const j={class:"daily-report-page"},N={class:"report-header"},O={class:"total-summary"},X={class:"total-amount"},Z={class:"daily-cards"},q={class:"card-header"},G={class:"date-label"},H={key:0,class:"daily-income"},J={class:"daily-total"},K={class:"card-content"},Q={class:"chart-section"},U={key:0,width:120,height:120,class:"pie-chart",viewBox:"0 0 120 120"},W=["d","fill"],z=["x","y","fill"],tt={key:1,class:"no-data"},et={class:"expense-list"},nt={class:"category-icon"},ot={class:"category-name"},st={class:"expense-amount"},at={key:1,class:"no-expense"},ct=b({__name:"DailyReportView",setup(rt){const $=R(),A=()=>{const s=[],o=new Date,t=new Date(o.getFullYear(),o.getMonth(),1),n=new Date(o.getFullYear(),o.getMonth(),o.getDate());console.log("當前日期:",o),console.log("當月1號:",t),console.log("今天:",n);let e=new Date(t);for(;e<=n;){const c=e.getFullYear(),h=String(e.getMonth()+1).padStart(2,"0"),y=String(e.getDate()).padStart(2,"0"),d=`${c}-${h}-${y}`;s.push(d),e.setDate(e.getDate()+1)}return console.log("日期範圍:",s),s},I=s=>{const o=$.transactions.filter(t=>t.date===s&&t.type==="expense");return console.log(`日期 ${s} 的交易:`,o),o},p=s=>I(s).reduce((t,n)=>t+n.amount,0),k=s=>$.transactions.filter(t=>t.date===s&&t.type==="income").reduce((t,n)=>t+n.amount,0),g=s=>{const o=I(s),t={};return o.forEach(e=>{t[e.category]||(t[e.category]={amount:0,count:0}),t[e.category].amount+=e.amount,t[e.category].count+=1}),Object.keys(t).map(e=>({category:e,amount:t[e].amount,count:t[e].count,categoryInfo:$.categories.find(c=>c.id===e)})).sort((e,c)=>c.amount-e.amount)},P=(s,o,t=80)=>{if(o===0)return[];const n=t/2,e=t/2-5;let c=-90;return s.map((h,y)=>{const d=h.amount/o,m=d*360,i=c+m,_=n+e*Math.cos(c*Math.PI/180),M=n+e*Math.sin(c*Math.PI/180),x=n+e*Math.cos(i*Math.PI/180),F=n+e*Math.sin(i*Math.PI/180),Y=m>180?1:0;let v;return d>=1?v=`M ${n} ${n} m -${e} 0 a ${e} ${e} 0 1 1 ${e*2} 0 a ${e} ${e} 0 1 1 -${e*2} 0`:v=[`M ${n} ${n}`,`L ${_} ${M}`,`A ${e} ${e} 0 ${Y} 1 ${x} ${F}`,"Z"].join(" "),c=i,{path:v,color:h.categoryInfo?.color||"#ccc",percentage:(d*100).toFixed(1)}})},B=s=>{const o=new Date(s),t=new Date,n=t.toLocaleDateString("en-CA"),e=new Date(t);e.setDate(e.getDate()-1);const c=e.toLocaleDateString("en-CA");return console.log("比較日期:",s,"今天:",n,"昨天:",c),s===n?"今天":s===c?"昨天":`${o.getMonth()+1}月${o.getDate()}日`},L=A(),C=new Date().toLocaleDateString("en-CA"),S=(s,o,t)=>{const n=t/2,e=t/2-30;if(o.length===1)return{x:n,y:n};let c=-90;for(let i=0;i<s;i++){const _=o[i].amount/o.reduce((M,x)=>M+x.amount,0);c+=_*360}const h=o[s].amount/o.reduce((i,_)=>i+_.amount,0),y=c+h*360/2,d=n+e*Math.cos(y*Math.PI/180),m=n+e*Math.sin(y*Math.PI/180);return{x:d,y:m}};return(s,o)=>(l(),r("div",j,[a("div",N,[o[1]||(o[1]=a("h2",null,"日報",-1)),a("div",O,[o[0]||(o[0]=a("span",{class:"total-label"},"總計",-1)),a("span",X,"$"+u(w(L).reduce((t,n)=>t+p(n),0).toLocaleString()),1)])]),a("div",Z,[(l(!0),r(f,null,D(w(L),t=>(l(),r("div",{key:t,class:V(["daily-card",{today:t===w(C)}])},[a("div",q,[a("span",G,u(B(t)),1),k(t)>0?(l(),r("span",H,"$"+u(k(t).toLocaleString()),1)):E("",!0),a("span",J,"$"+u(p(t).toLocaleString()),1)]),a("div",K,[a("div",Q,[p(t)>0?(l(),r("svg",U,[(l(!0),r(f,null,D(P(g(t),p(t),120),(n,e)=>(l(),r("g",{key:e},[a("path",{d:n.path,fill:n.color,class:"pie-slice"},null,8,W)]))),128)),(l(!0),r(f,null,D(g(t).slice(0,3),(n,e)=>(l(),r("g",{key:`icon-${n.category}`},[a("text",{x:S(e,g(t),120).x,y:S(e,g(t),120).y,class:"chart-icon-text",fill:n.categoryInfo?.color||"#333"},u(n.categoryInfo?.icon||"📝"),9,z)]))),128))])):(l(),r("div",tt,"無資料"))]),a("div",et,[g(t).length>0?(l(!0),r(f,{key:0},D(g(t),n=>(l(),r("div",{key:n.category,class:"expense-item"},[a("span",nt,u(n.categoryInfo?.icon||"📝"),1),a("span",ot,u(n.categoryInfo?.name||n.category),1),a("span",st,"$"+u(n.amount.toLocaleString()),1)]))),128)):(l(),r("div",at," 無支出記錄 "))])])],2))),128))])]))}}),it=T(ct,[["__scopeId","data-v-81712601"]]);export{it as default};
