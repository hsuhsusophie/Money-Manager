import{d as C,u as Y,c as r,a,t as u,b as v,F as f,r as D,n as b,e as R,o as l,_ as V}from"./index-BgtN8iJC.js";const E={class:"daily-report-page"},j={class:"report-header"},N={class:"total-summary"},X={class:"total-amount"},Z={class:"daily-cards"},q={class:"card-header"},G={class:"date-label"},H={key:0,class:"daily-income"},J={class:"daily-total"},K={class:"card-content"},Q={class:"chart-section"},U={key:0,width:120,height:120,class:"pie-chart",viewBox:"0 0 120 120"},W=["d","fill"],z=["x","y","fill"],tt={key:1,class:"no-data"},et={class:"expense-list"},nt={class:"category-icon"},ot={class:"category-name"},st={class:"expense-amount"},at={key:1,class:"no-expense"},ct=C({__name:"DailyReportView",setup(rt){const $=Y(),T=()=>{const s=[],o=new Date,t=new Date(o.getFullYear(),o.getMonth(),1),n=new Date(o.getFullYear(),o.getMonth(),o.getDate());console.log("當前日期:",o),console.log("當月1號:",t),console.log("今天:",n);let e=new Date(t);for(;e<=n;){const c=e.getFullYear(),h=String(e.getMonth()+1).padStart(2,"0"),p=String(e.getDate()).padStart(2,"0"),g=`${c}-${h}-${p}`;s.push(g),e.setDate(e.getDate()+1)}return console.log("日期範圍:",s),s},w=s=>{const o=$.transactions.filter(t=>t.date===s&&t.type==="expense");return console.log(`日期 ${s} 的交易:`,o),o},_=s=>w(s).reduce((t,n)=>t+n.amount,0),S=s=>$.transactions.filter(t=>t.date===s&&t.type==="income").reduce((t,n)=>t+n.amount,0),d=s=>{const o=w(s),t={};return o.forEach(e=>{t[e.category]||(t[e.category]={amount:0,count:0}),t[e.category].amount+=e.amount,t[e.category].count+=1}),Object.keys(t).map(e=>({category:e,amount:t[e].amount,count:t[e].count,categoryInfo:$.categories.find(c=>c.id===e)})).sort((e,c)=>c.amount-e.amount)},B=(s,o,t=80)=>{if(o===0)return[];const n=t/2,e=t/2-5;let c=-90;return s.map((h,p)=>{const g=h.amount/o,m=g*360,i=c+m,y=n+e*Math.cos(c*Math.PI/180),I=n+e*Math.sin(c*Math.PI/180),M=n+e*Math.cos(i*Math.PI/180),A=n+e*Math.sin(i*Math.PI/180),O=m>180?1:0;let x;return g>=1?x=`M ${n} ${n} m -${e} 0 a ${e} ${e} 0 1 1 ${e*2} 0 a ${e} ${e} 0 1 1 -${e*2} 0`:x=[`M ${n} ${n}`,`L ${y} ${I}`,`A ${e} ${e} 0 ${O} 1 ${M} ${A}`,"Z"].join(" "),c=i,{path:x,color:h.categoryInfo?.color||"#ccc",percentage:(g*100).toFixed(1)}})},F=s=>{const o=new Date(s),t=new Date,n=new Date(t.getTime());n.setDate(n.getDate()-1);const e=new Date(t.getTime());return e.setDate(e.getDate()+1),s===t.toISOString().split("T")[0]?"今天":s===n.toISOString().split("T")[0]?"昨天":s===e.toISOString().split("T")[0]?"明天":`${o.getMonth()+1}月${o.getDate()}日`},k=T(),L=new Date().toISOString().split("T")[0],P=(s,o,t)=>{const n=t/2,e=t/2-30;if(o.length===1)return{x:n,y:n};let c=-90;for(let i=0;i<s;i++){const y=o[i].amount/o.reduce((I,M)=>I+M.amount,0);c+=y*360}const h=o[s].amount/o.reduce((i,y)=>i+y.amount,0),p=c+h*360/2,g=n+e*Math.cos(p*Math.PI/180),m=n+e*Math.sin(p*Math.PI/180);return{x:g,y:m}};return(s,o)=>(l(),r("div",E,[a("div",j,[o[1]||(o[1]=a("h2",null,"日報",-1)),a("div",N,[o[0]||(o[0]=a("span",{class:"total-label"},"總計",-1)),a("span",X,"$"+u(v(k).reduce((t,n)=>t+_(n),0).toLocaleString()),1)])]),a("div",Z,[(l(!0),r(f,null,D(v(k),t=>(l(),r("div",{key:t,class:b(["daily-card",{today:t===v(L)}])},[a("div",q,[a("span",G,u(F(t)),1),S(t)>0?(l(),r("span",H,"$"+u(S(t).toLocaleString()),1)):R("",!0),a("span",J,"$"+u(_(t).toLocaleString()),1)]),a("div",K,[a("div",Q,[_(t)>0?(l(),r("svg",U,[(l(!0),r(f,null,D(B(d(t),_(t),120),(n,e)=>(l(),r("g",{key:e},[a("path",{d:n.path,fill:n.color,class:"pie-slice"},null,8,W)]))),128)),(l(!0),r(f,null,D(d(t).slice(0,3),(n,e)=>(l(),r("g",{key:`icon-${n.category}`},[a("text",{x:P(e,d(t),120).x,y:P(e,d(t),120).y,class:"chart-icon-text",fill:n.categoryInfo?.color||"#333"},u(n.categoryInfo?.icon||"📝"),9,z)]))),128))])):(l(),r("div",tt,"無資料"))]),a("div",et,[d(t).length>0?(l(!0),r(f,{key:0},D(d(t),n=>(l(),r("div",{key:n.category,class:"expense-item"},[a("span",nt,u(n.categoryInfo?.icon||"📝"),1),a("span",ot,u(n.categoryInfo?.name||n.category),1),a("span",st,"$"+u(n.amount.toLocaleString()),1)]))),128)):(l(),r("div",at," 無支出記錄 "))])])],2))),128))])]))}}),it=V(ct,[["__scopeId","data-v-87759039"]]);export{it as default};
